{% extends "base.html" %}

{% block title %}{{ restaurant.name }} - ë ˆìŠ¤í† ë‘ ìƒì„¸{% endblock %}

{% block extra_styles %}
<style>
    .restaurant-detail-container {
        max-width: 1000px;
        margin: 0 auto;
        background-color: #ffffff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .restaurant-image {
        width: 100%;
        height: 400px;
        object-fit: cover;
        background-color: #f0f0f0;
    }

    .restaurant-info {
        padding: 2rem;
    }

    .restaurant-header {
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 1.5rem;
        margin-bottom: 2rem;
    }

    .restaurant-name {
        font-size: 2rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 0.75rem;
    }

    .restaurant-category {
        display: inline-block;
        padding: 0.5rem 1rem;
        background-color: #fff5f0;
        color: #ff8c42;
        border-radius: 20px;
        font-size: 0.95rem;
        font-weight: 600;
        margin-bottom: 1rem;
    }

    .restaurant-rating {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1.1rem;
        margin-top: 0.5rem;
    }

    .rating-stars {
        color: #ffc107;
        font-size: 1.3rem;
    }

    .rating-value {
        font-weight: bold;
        color: #333;
    }

    .info-section {
        margin-bottom: 2rem;
    }

    .info-row {
        display: flex;
        align-items: center;
        padding: 1rem 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-label {
        font-weight: 600;
        color: #666;
        min-width: 120px;
        font-size: 1rem;
    }

    .info-value {
        color: #333;
        font-size: 1rem;
    }

    .phone-link {
        color: #ff8c42;
        text-decoration: none;
        transition: opacity 0.3s ease;
    }

    .phone-link:hover {
        opacity: 0.8;
        text-decoration: underline;
    }

    .action-buttons {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 2px solid #f0f0f0;
    }

    .btn {
        flex: 1;
        padding: 1rem 2rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        text-decoration: none;
        display: inline-block;
    }

    .btn-primary {
        background-color: #ff8c42;
        color: white;
    }

    .btn-primary:hover {
        background-color: #ff7a28;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(255, 140, 66, 0.3);
    }

    .btn-secondary {
        background-color: #f0f0f0;
        color: #333;
    }

    .btn-secondary:hover {
        background-color: #e0e0e0;
    }

    .no-image {
        width: 100%;
        height: 400px;
        background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: #ccc;
    }

    .similar-restaurant-card {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem;
        margin-bottom: 0.75rem;
        background-color: #f8f9fa;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .similar-restaurant-card:hover {
        background-color: #fff5f0;
        transform: translateX(4px);
    }

    .similar-restaurant-info {
        flex: 1;
    }

    .similar-restaurant-name {
        font-size: 1.1rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 0.25rem;
    }

    .similar-restaurant-category {
        font-size: 0.9rem;
        color: #666;
    }

    .similar-restaurant-arrow {
        font-size: 1.5rem;
        color: #ff8c42;
    }
</style>
{% endblock %}

{% block content %}
<div class="restaurant-detail-container">
    {% if restaurant.image_url %}
        <img src="{{ restaurant.image_url }}" alt="{{ restaurant.name }}" class="restaurant-image">
    {% else %}
        <div class="no-image">ğŸ½ï¸</div>
    {% endif %}

    <div class="restaurant-info">
        <div class="restaurant-header">
            <h1 class="restaurant-name">{{ restaurant.name }}</h1>

            {% if restaurant.category %}
            <span class="restaurant-category">{{ restaurant.category }}</span>
            {% endif %}

            {% if restaurant.rating %}
            <div class="restaurant-rating">
                <span class="rating-stars">â˜…â˜…â˜…â˜…â˜…</span>
                <span class="rating-value">{{ restaurant.rating }}</span>
            </div>
            {% endif %}
        </div>

        <div class="info-section">
            {% if restaurant.phone %}
            <div class="info-row">
                <div class="info-label">ì „í™”ë²ˆí˜¸</div>
                <div class="info-value">
                    <a href="tel:{{ restaurant.phone }}" class="phone-link">{{ restaurant.phone }}</a>
                </div>
            </div>
            {% endif %}

            {% if restaurant.address %}
            <div class="info-row">
                <div class="info-label">ì£¼ì†Œ</div>
                <div class="info-value">{{ restaurant.address }}</div>
            </div>
            {% endif %}

            <div class="info-row">
                <div class="info-label">ì¹´í…Œê³ ë¦¬</div>
                <div class="info-value">{{ restaurant.category|default:"ë¯¸ë¶„ë¥˜" }}</div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn btn-primary" onclick="makeReservation()">ì˜ˆì•½í•˜ê¸°</button>
            <a href="{% url 'main:llm' %}" class="btn btn-secondary">ì±—ë´‡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </div>
</div>

<div class="restaurant-detail-container" id="similarRestaurantsSection" style="margin-top: 2rem; display: none;">
    <div class="restaurant-info">
        <h2 style="font-size: 1.5rem; font-weight: 600; color: #333; margin-bottom: 1.5rem;">ğŸ½ï¸ ë¹„ìŠ·í•œ ì‹ë‹¹ ì¶”ì²œ</h2>
        <div id="similarRestaurantsList"></div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¹„ìŠ·í•œ ì‹ë‹¹ ë¡œë“œ
    document.addEventListener('DOMContentLoaded', function() {
        loadSimilarRestaurants();
    });

    function makeReservation() {
        // ì˜ˆì•½ í™•ì¸
        const confirmed = confirm('{{ restaurant.name }}ì„(ë¥¼) ì˜ˆì•½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');

        if (confirmed) {
            // ì‹¤ì œ êµ¬í˜„ì‹œì—ëŠ” ì„œë²„ì— ì˜ˆì•½ ìš”ì²­ì„ ë³´ë‚´ëŠ” ë¡œì§ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤
            // ì§€ê¸ˆì€ í…ŒìŠ¤íŠ¸ í™˜ê²½ì´ë¯€ë¡œ ë°”ë¡œ ì„±ê³µ ì²˜ë¦¬
            alert('ì˜ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤');

            // ì˜ˆì•½ í›„ ì±—ë´‡ í˜ì´ì§€ë¡œ ì´ë™ (ì„ íƒì‚¬í•­)
            // window.location.href = "{% url 'main:llm' %}";
        }
    }

    async function loadSimilarRestaurants() {
        try {
            const response = await fetch("{% url 'main:get_similar_restaurants' restaurant.restaurant_ID %}");
            const data = await response.json();

            if (data.similar_restaurants && data.similar_restaurants.length > 0) {
                displaySimilarRestaurants(data.similar_restaurants);
                document.getElementById('similarRestaurantsSection').style.display = 'block';
            }
        } catch (error) {
            console.error('Error loading similar restaurants:', error);
        }
    }

    function displaySimilarRestaurants(restaurants) {
        const container = document.getElementById('similarRestaurantsList');
        container.innerHTML = '';

        restaurants.forEach(restaurant => {
            const card = document.createElement('div');
            card.className = 'similar-restaurant-card';
            card.innerHTML = `
                <div class="similar-restaurant-info">
                    <div class="similar-restaurant-name">${restaurant.name}</div>
                    <div class="similar-restaurant-category">${restaurant.category}</div>
                </div>
                <div class="similar-restaurant-arrow">â†’</div>
            `;

            card.addEventListener('click', function() {
                window.location.href = `/restaurant/${restaurant.restaurant_ID}/`;
            });

            container.appendChild(card);
        });
    }
</script>
{% endblock %}
